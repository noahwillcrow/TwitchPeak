/**
 * jquery-simula v0.4.0
 * built on 06.01.2013
 * Copyright 2013 Manuel Leuenberger
 * licenced under MIT, see LICENSE.txt
 */
(function(t){function e(){}function i(){this.observers=[]}function n(e){var i=t.extend({},{bubbles:!0,cancelable:!0},e);this.type=i.type,this.bubbles=i.bubbles,this.cancelable=i.cancelable}function s(e){n.apply(this,[e]);var i=t.extend({},{view:window,detail:0},e);this.view=i.view,this.detail=i.detail}function o(e){s.apply(this,[e]);var i=t.extend({},{screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1,button:t.simula.SimulaMouseEvent.BUTTON.LEFT,relatedTarget:document},e);this.screenX=i.screenX,this.screenY=i.screenY,this.clientX=i.clientX,this.clientY=i.clientY,this.ctrlKey=i.ctrlKey,this.shiftKey=i.shiftKey,this.altKey=i.altKey,this.metaKey=i.metaKey,this.button=i.button,this.relatedTarget=i.relatedTarget}function r(){i.apply(this),this.running=!1}function u(t){r.apply(this),this.simulators=t,this.currentIndex=-1}function h(t){r.apply(this),this.time=t,this.timeoutId=null}function l(t,e){r.apply(this),this.$element=t,this.simulaEvent=e,this.listener=function(){},this.event=null}function p(t,e){l.apply(this,[t,e])}function a(t,e){r.apply(this),this.simulatorQueue=new u([]),this.$element=t,this.elementPosition=[e[0],e[1]]}var m=!1,c=!0;t.elementFromPoint=function(e,i){if(!document.elementFromPoint)return null;if(!m){m=!0;var n=t(document).scrollTop(),s=t(document).scrollLeft();n>0?c=null==document.elementFromPoint(0,n+t(window).height()-1):s>0?c=null==document.elementFromPoint(s+t(window).width()-1,0):m=!1}return c||(e+=t(document).scrollLeft(),i+=t(document).scrollTop()),document.elementFromPoint(e,i)},t.fn.equals=function(e){return this[0]==t(e)[0]},t.fn.isParentOf=function(e){for(var i=t(e);i[0]&&!this.equals(i);)i=i.parent();return!this.equals(e)&&this.equals(i)},e.prototype.updateObservable=function(){},i.prototype.updateObservers=function(t){for(var e=0;this.observers.length>e;e++)this.observers[e].updateObservable(this,t)},i.prototype.addObserver=function(t){for(var e=0;this.observers.length>e;e++){var i=this.observers[e];if(i==t)return}this.observers.push(t)},i.prototype.removeObserver=function(t){for(var e=0;this.observers.length>e;e++){var i=this.observers[e];if(i==t)return this.observers.splice(e,1),undefined}},n.PHASE={CAPTURING:1,AT_TARGET:2,BUBBLING:3},s.prototype=new n,s.prototype.constructor=s,o.prototype=new s,o.prototype.constructor=o,o.BUTTON={LEFT:0,MIDDLE:1,RIGHT:2},o.TYPE={CLICK:"click",DOWN:"mousedown",UP:"mouseup",OVER:"mouseover",OUT:"mouseout",MOVE:"mousemove"},r.prototype=new i,r.prototype.constructor=r,r.prototype.finish=function(){this.running=!1,this.updateObservers("finish")},r.prototype.execute=function(){if(this.isRunning())throw Error("Simulator is already running");this.running=!0},r.prototype.stop=function(){this.isRunning()&&(this.running=!1,this.updateObservers("stop"))},r.prototype.isRunning=function(){return this.running},u.prototype=new r,u.prototype.constructor=u,u.prototype.updateObservable=function(t,e){if(!("finish"!=e||0>this.currentIndex||this.currentIndex>=this.simulators.length||t!=this.simulators[this.currentIndex])){var i=this.simulators[this.currentIndex];i.removeObserver(this),this.currentIndex<this.simulators.length-1?this.proceed():this.finish()}},u.prototype.finish=function(){this.currentIndex=-1,r.prototype.finish.apply(this)},u.prototype.execute=function(){r.prototype.execute.apply(this),this.simulators.length>0?this.proceed():this.finish()},u.prototype.stop=function(){if(this.isRunning()){var t=this.simulators[this.currentIndex];t.stop(),this.currentIndex=-1}r.prototype.stop.apply(this)},u.prototype.proceed=function(){this.currentIndex++;var t=this.simulators[this.currentIndex];t.addObserver(this),t.execute()},h.prototype=new r,h.prototype.constructor=h,h.prototype.execute=function(){r.prototype.execute.apply(this),this.timeoutId=setTimeout(t.proxy(function(){this.finish()},this),this.time)},h.prototype.stop=function(){this.isRunning()&&clearTimeout(this.timeoutId),r.prototype.stop.apply(this)},l.prototype=new r,l.prototype.constructor=l,l.prototype.buildEvent=function(){return null},l.prototype.addEventListener=function(){},l.prototype.removeEventListener=function(){},l.prototype.handleEvent=function(t){t==this.event&&(this.removeEventListener(t),this.listener=function(){},this.event=null,this.finish())},l.prototype.dispatchEvent=function(){},l.prototype.execute=function(){r.prototype.execute.apply(this),this.event=this.buildEvent(),this.listener=t.proxy(function(t){this.handleEvent(t)},this),this.addEventListener(),this.dispatchEvent()},p.prototype=new l,p.prototype.constructor=p,p.prototype.buildEvent=function(){var t=this.simulaEvent,e=document.createEvent("MouseEvents");return e.initMouseEvent(t.type,t.bubbles,t.cancelable,t.view,t.detail,t.screenX,t.screenY,t.clientX,t.clientY,t.ctrlKey,t.altKey,t.shiftKey,t.metaKey,t.button,t.relatedTarget),e},p.prototype.addEventListener=function(){this.$element.get(0).addEventListener(this.event.type,this.listener,!1)},p.prototype.removeEventListener=function(){this.$element.get(0).removeEventListener(this.event.type,this.listener,!1)},p.prototype.dispatchEvent=function(){this.$element.get(0).dispatchEvent(this.event)};var f=p;a.prototype=new r,a.prototype.constructor=a,a.prototype.updateObservable=function(t,e){"finish"==e&&t==this.simulatorQueue&&(this.simulatorQueue.removeObserver(this),this.finish())},a.prototype.execute=function(){r.prototype.execute.apply(this),this.simulatorQueue.addObserver(this),this.simulatorQueue.execute()},a.prototype.wait=function(t){return t||(t=50),this.simulatorQueue.simulators.push(new h(t)),this},a.prototype.mousemove=function(e,i){i||(i={}),e||(e=this.$element);var n=new o(t.extend({},i,{type:o.TYPE.MOVE,cancelable:!1}));return this.simulatorQueue.simulators.push(new f(e,n)),this},a.prototype.mouseover=function(e,i){i||(i={}),e||(e=this.$element);var n=new o(t.extend({},i,{type:o.TYPE.OVER}));return this.simulatorQueue.simulators.push(new f(e,n)),this},a.prototype.mouseout=function(e,i){i||(i={}),e||(e=this.$element);var n=new o(t.extend({},i,{type:o.TYPE.OUT}));return this.simulatorQueue.simulators.push(new f(e,n)),this},a.prototype.mousedown=function(e,i){i||(i={}),e||(e=this.$element);var n=new o(t.extend({button:o.BUTTON.LEFT},i,{type:o.TYPE.DOWN}));return this.simulatorQueue.simulators.push(new f(e,n)),this},a.prototype.mouseup=function(e,i){i||(i={}),e||(e=this.$element);var n=new o(t.extend({button:o.BUTTON.LEFT},i,{type:o.TYPE.UP}));return this.simulatorQueue.simulators.push(new f(e,n)),this},a.prototype.mouseclick=function(e,i){i||(i={}),e||(e=this.$element);var n=new o(t.extend({button:o.BUTTON.LEFT},i,{type:o.TYPE.CLICK}));return this.simulatorQueue.simulators.push(new f(e,n)),this},a.prototype.move=function(e,i,n,s){var o=e[0]-this.elementPosition[0],r=e[1]-this.elementPosition[1];i||(i=Math.sqrt(o*o+r*r)),n||(n={});for(var u=[],h=15;i>=h;)u.push({wait:15,dPosition:[h/i*o,h/i*r]}),h+=15;0!==i%15&&u.push({wait:i%15,dPosition:[o,r]});for(var l=[this.$element.offset().left+this.elementPosition[0],this.$element.offset().top+this.elementPosition[1]],p=0;u.length>p;p++){var a=u[p],m=l[0]+a.dPosition[0],c=l[1]+a.dPosition[1];this.wait(a.wait);var f=t(t.elementFromPoint(m,c));s&&!this.$element.equals(f)&&((f.isParentOf(this.$element)||!this.$element.isParentOf(f))&&this.mouseout(this.$element,t.extend({},n,{clientX:m,clientY:c,relatedTarget:f.get(0)})),(this.$element.isParentOf(f)||!f.isParentOf(this.$element))&&this.mouseover(f,t.extend({},n,{clientX:m,clientY:c,relatedTarget:this.$element.get(0)})),this.$element=f),this.mousemove(this.$element,t.extend({},n,{clientX:m,clientY:c})),this.elementPosition=[m-this.$element.offset().left,c-this.$element.offset().top]}return this},a.prototype.enter=function(e,i){if(i||(i={}),this.$element.isParentOf(e)){var n=[];e.parents().each(function(){n.push(t(this))});for(var s=n.pop();!s.equals(this.$element);)s=n.pop();s=n.pop()||e;var o=s.offset().left-this.$element.offset().left+s.width()/2,r=s.offset().top-this.$element.offset().top+s.height()/2;this.move([o,r]),this.mouseover(s,t.extend({},i,{clientX:this.$element.offset().left+o,clientY:this.$element.offset().top+r,relatedTarget:this.$element.get(0)})),this.$element=s,this.elementPosition=[s.width()/2,s.height()/2],this.$element.equals(e)||this.enter(e)}else this.leave(this.$element),this.enter(e);return this},a.prototype.leave=function(e,i){if(e||(e=this.$element),i||(i={}),e.isParentOf(this.$element)||e.equals(this.$element)){var n=this.$element,s=this.$element.parent(),o=s.width()/2-(n.offset().left-s.offset().left),r=s.height()/2-(n.offset().top-s.offset().top);this.move([o,r]),this.mouseout(n,t.extend({},i,{clientX:n.offset().left+o,clientY:n.offset().top+r,relatedTarget:s.get(0)})),this.$element=s,this.elementPosition=[s.width()/2,s.height()/2],this.$element.equals(e.parent())||this.leave(e)}else this.enter(e),this.leave(e);return this},a.prototype.press=function(e,i){return e||(e=this.$element),i||(i={}),this.$element.equals(e)||this.enter(e),this.mousedown(this.$element,t.extend({},i,{clientX:this.$element.offset().left+this.elementPosition[0],clientY:this.$element.offset().top+this.elementPosition[1]})),this},a.prototype.release=function(e,i){return e||(e=this.$element),i||(i={}),this.$element.equals(e)||this.enter(e),this.mouseup(this.$element,t.extend({},i,{clientX:this.$element.offset().left+this.elementPosition[0],clientY:this.$element.offset().top+this.elementPosition[1]})),this},a.prototype.click=function(e,i){return e||(e=this.$element),i||(i={}),this.press(e),this.wait(5),this.release(this.$element),this.wait(5),this.mouseclick(this.$element,t.extend({},i,{clientX:this.$element.offset().left+this.elementPosition[0],clientY:this.$element.offset().top+this.elementPosition[1]})),this},t.simula={},t.simula.Observer=e,t.simula.Observable=i,t.simula.Simulator=r,t.simula.SimulatorQueue=u,t.simula.TimeSimulator=h,t.simula.EventSimulator=l,t.simula.SimulaEvent=n,t.simula.SimulaUiEvent=s,t.simula.SimulaMouseEvent=o,t.simula.MouseEventSimulator=f,t.simula.Simulation=a})(jQuery);